<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDKs (Compat version for simple HTML use) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- Custom Font: Sarabun for Thai support -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #E0E5EC;
        }
        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-popIn {
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        /* Scrollbar hiding for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAfVVjMd0uGPtVZz0uvotGr-txalaQHjBg",
            authDomain: "auto-text-generator-9c301.firebaseapp.com",
            projectId: "auto-text-generator-9c301",
            storageBucket: "auto-text-generator-9c301.firebasestorage.app",
            messagingSenderId: "412199573548",
            appId: "1:412199573548:web:b8f8f6e3ea9e805b375989",
            measurementId: "G-E70PKK08XE"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- Icons Components ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const ClipboardListIcon = (props) => (<Icon {...props}><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path d="M8 11h.01"></path><path d="M8 16h.01"></path></Icon>);
        const StoreIcon = (props) => (<Icon {...props}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"></path><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"></path><path d="M2 7h20"></path><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"></path></Icon>);
        const FileTextIcon = (props) => (<Icon {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></Icon>);
        const UserIcon = (props) => (<Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></Icon>);
        const CheckIcon = (props) => (<Icon {...props}><polyline points="20 6 9 17 4 12"></polyline></Icon>);
        const ClockIcon = (props) => (<Icon {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>);
        const Edit3Icon = (props) => (<Icon {...props}><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></Icon>);
        const XIcon = (props) => (<Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>);
        const CopyIcon = (props) => (<Icon {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></Icon>);
        const SaveIcon = (props) => (<Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></Icon>);
        const TrashIcon = (props) => (<Icon {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></Icon>);
        const HistoryIcon = (props) => (<Icon {...props}><path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path></Icon>);
        const SearchIcon = (props) => (<Icon {...props}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></Icon>);
        const ArrowLeftIcon = (props) => (<Icon {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></Icon>);
        const AlertIcon = (props) => (<Icon {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></Icon>);
        const DownloadIcon = (props) => (<Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></Icon>);
        const UploadIcon = (props) => (<Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></Icon>);
        const GoogleIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24px" height="24px" {...props}>
                <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
                <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
                <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
                <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
            </svg>
        );
        const LogoutIcon = (props) => (<Icon {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></Icon>);
        const MailIcon = (props) => (<Icon {...props}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></Icon>);
        const LockIcon = (props) => (<Icon {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></Icon>);

        // --- Utils ---
        const getCurrentDateTime = () => {
            const now = new Date();
            const date = now.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const time = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
            return `${date} - ${time} ‡∏ô.`;
        };

        const STORAGE_KEY = 'neumorph_app_data_v1';

        // --- Auth Component ---
        const AuthPage = ({ onLoginSuccess }) => {
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [username, setUsername] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            const [resetSent, setResetSent] = useState(false);

            // Styles (Reusing from main app for consistency)
            const styles = {
                bg: 'bg-[#E0E5EC]',
                text: 'text-gray-800',
                neuFlat: `bg-[#E0E5EC] shadow-[9px_9px_16px_rgb(163,177,198,0.6),-9px_-9px_16px_rgba(255,255,255,0.5)] rounded-2xl`,
                neuPressed: `bg-[#E0E5EC] shadow-[inset_6px_6px_10px_rgb(163,177,198,0.6),inset_-6px_-6px_10px_rgba(255,255,255,0.8)] rounded-xl`,
                btn: `transition-all duration-200 ease-in-out active:scale-95 flex items-center justify-center font-medium cursor-pointer select-none`,
            };

            const handleGoogleLogin = async () => {
                setLoading(true);
                setError('');
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                    // onLoginSuccess handled by onAuthStateChanged in parent
                } catch (err) {
                    let msg = err.message;
                    if (err.code === 'auth/unauthorized-domain') {
                        msg = "‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô Firebase Console (‡πÄ‡∏°‡∏ô‡∏π Authentication > Settings > Authorized Domains)";
                    } else if (err.code === 'auth/popup-closed-by-user') {
                        msg = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
                    }
                    setError(msg);
                    setLoading(false);
                }
            };

            const handleEmailAuth = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (isLoginMode) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        if (password !== confirmPassword) {
                            throw new Error("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô");
                        }
                        if (!username) {
                            throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
                        }
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        // Update display name
                        await userCredential.user.updateProfile({
                            displayName: username
                        });
                        // Force refresh user to get updated profile
                        await auth.currentUser.reload();
                    }
                } catch (err) {
                    let msg = err.message;
                    if (err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found' || err.code === 'auth/invalid-credential') msg = "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
                    if (err.code === 'auth/email-already-in-use') msg = "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
                    if (err.code === 'auth/weak-password') msg = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£";
                    if (msg === "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô") msg = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô";
                    if (msg === "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô") msg = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                    setError(msg);
                    setLoading(false);
                }
            };

            const handleForgotPassword = async () => {
                if (!email) {
                    setError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
                    return;
                }
                try {
                    await auth.sendPasswordResetEmail(email);
                    setResetSent(true);
                    setError('');
                } catch (err) {
                    setError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏î‡πâ: " + err.message);
                }
            };

            return (
                <div className={`min-h-screen ${styles.bg} flex items-center justify-center p-4`}>
                    <div className={`w-full max-w-md ${styles.neuFlat} p-8 space-y-6 animate-popIn`}>
                        <div className="text-center space-y-2">
                            <h1 className="text-3xl font-bold text-blue-900">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
                            <div className="flex justify-center items-center gap-4 text-sm font-medium text-gray-500">
                                <button 
                                    onClick={() => { setIsLoginMode(true); setError(''); setResetSent(false); }}
                                    className={`${isLoginMode ? 'text-blue-900 font-bold scale-105' : 'hover:text-blue-700'} transition-all`}
                                >
                                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                                </button>
                                <span className="h-4 w-px bg-gray-400"></span>
                                <button 
                                    onClick={() => { setIsLoginMode(false); setError(''); setResetSent(false); }}
                                    className={`${!isLoginMode ? 'text-blue-900 font-bold scale-105' : 'hover:text-blue-700'} transition-all`}
                                >
                                    ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                                </button>
                            </div>
                        </div>

                        {error && (
                            <div className="p-3 rounded-xl bg-red-100 border border-red-200 text-red-600 text-sm text-center animate-fadeIn break-words">
                                {error}
                            </div>
                        )}
                         {resetSent && (
                            <div className="p-3 rounded-xl bg-green-100 border border-green-200 text-green-700 text-sm text-center animate-fadeIn">
                                ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                            </div>
                        )}

                        <form onSubmit={handleEmailAuth} className="space-y-4">
                            <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <MailIcon size={18} />
                                </div>
                                <input
                                    type="email"
                                    placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                    required
                                />
                            </div>

                            {!isLoginMode && (
                                <div className="relative animate-fadeIn">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                        <UserIcon size={18} />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                        required
                                    />
                                </div>
                            )}

                            <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                    <LockIcon size={18} />
                                </div>
                                <input
                                    type="password"
                                    placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                    required
                                />
                            </div>

                            {!isLoginMode && (
                                <div className="relative animate-fadeIn">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                        <CheckIcon size={18} />
                                    </div>
                                    <input
                                        type="password"
                                        placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                                        value={confirmPassword}
                                        onChange={(e) => setConfirmPassword(e.target.value)}
                                        className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                        required
                                    />
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={loading}
                                className={`w-full py-3 rounded-xl text-blue-900 font-bold text-lg ${styles.neuFlat} hover:translate-y-[-2px] active:translate-y-[0px] shadow-[5px_5px_10px_rgb(163,177,198,0.6),-5px_-5px_10px_rgba(255,255,255,0.8)]`}
                            >
                                {loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...' : (isLoginMode ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô')}
                            </button>
                        </form>
                        
                        {isLoginMode && (
                             <div className="text-center">
                                <button 
                                    onClick={handleForgotPassword}
                                    type="button" 
                                    className="text-sm text-gray-500 hover:text-blue-700 hover:underline"
                                >
                                    ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?
                                </button>
                            </div>
                        )}

                        <div className="relative flex py-2 items-center">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="flex-shrink-0 mx-4 text-gray-400 text-xs">‡∏´‡∏£‡∏∑‡∏≠</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>

                        <button
                            onClick={handleGoogleLogin}
                            disabled={loading}
                            className={`w-full py-3 rounded-xl flex items-center justify-center gap-3 text-gray-700 font-medium ${styles.neuFlat} hover:translate-y-[-2px] active:translate-y-[0px] shadow-[5px_5px_10px_rgb(163,177,198,0.6),-5px_-5px_10px_rgba(255,255,255,0.8)]`}
                        >
                            <GoogleIcon />
                            <span>{isLoginMode ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ Google'}</span>
                        </button>
                        
                        <div className="pt-6 mt-4 border-t border-gray-300/30 text-center">
                            <p className="text-[10px] text-gray-400 font-light tracking-widest uppercase opacity-70 hover:opacity-100 transition-opacity select-none">
                                vibe code by a.pete from zenity-x
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const NeumorphismApp = () => {
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            // View State: 'form' or 'history'
            const [currentView, setCurrentView] = useState('form');
            const [isClearingHistory, setIsClearingHistory] = useState(false);
            
            // Data State
            const [storeName, setStoreName] = useState('');
            const [invNumber, setInvNumber] = useState('');
            const [customerName, setCustomerName] = useState('');
            const [generatedText, setGeneratedText] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            
            // Tracking State for "Edit Mode"
            const [currentId, setCurrentId] = useState(null); 

            // History State
            const [history, setHistory] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            
            // File input ref for import
            const fileInputRef = useRef(null);

            const initialItems = [
                { id: 1, label: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' },
                { id: 2, label: '‡∏≠‡∏≤‡∏ä‡∏µ‡∏û' },
                { id: 3, label: '‡πÄ‡∏ü‡∏™‡∏ö‡∏∏‡πä‡∏Ñ' },
                { id: 4, label: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á' },
                { id: 5, label: '‡∏£‡∏π‡∏õ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\n(‡∏´‡∏ô‡πâ‡∏≤-‡∏´‡∏•‡∏±‡∏á,‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤,‡∏ö‡∏ô-‡∏•‡πà‡∏≤‡∏á)' },
                { id: 6, label: '‡∏£‡∏π‡∏õ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\n(‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö,‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏ö‡∏ï,‡∏ï‡∏£‡∏≤‡∏Ñ‡∏£‡∏∏‡∏ë)' },
                { id: 7, label: '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏ç‡∏≤' },
                { id: 8, label: '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°' },
                { id: 9, label: '‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à' },
                { id: 10, label: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏•‡∏ô‡πå' },
                { id: 11, label: '‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡∏™‡∏•‡πá‡∏≠‡∏Å\n(3‡∏†‡∏≤‡∏û)' },
                { id: 12, label: '‡∏£‡∏π‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏ö‡πÄ‡∏Ñ‡∏™' },
            ];

            const [checklist, setChecklist] = useState(
                initialItems.map((item) => ({ ...item, status: 'pending', note: '' }))
            );

            // Auth Listener
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setAuthLoading(false);
                });
                return () => unsubscribe();
            }, []);

            // Load History (Firestore or LocalStorage logic)
            useEffect(() => {
                if (!user) return; // Wait for login

                // Listen to Firestore real-time updates for the logged-in user
                const unsubscribe = db.collection('users').doc(user.uid).collection('history')
                    .orderBy('timestamp_raw', 'desc')
                    .onSnapshot((snapshot) => {
                        const loadedHistory = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setHistory(loadedHistory);
                    }, (error) => {
                        console.error("Error fetching history:", error);
                    });

                return () => unsubscribe();
            }, [user]);

            // Styles
            const styles = {
                bg: 'bg-[#E0E5EC]',
                text: 'text-gray-800',
                primary: 'text-blue-900',
                neuFlat: `bg-[#E0E5EC] shadow-[9px_9px_16px_rgb(163,177,198,0.6),-9px_-9px_16px_rgba(255,255,255,0.5)] rounded-2xl`,
                neuPressed: `bg-[#E0E5EC] shadow-[inset_6px_6px_10px_rgb(163,177,198,0.6),inset_-6px_-6px_10px_rgba(255,255,255,0.8)] rounded-xl`,
                btn: `transition-all duration-200 ease-in-out active:scale-95 flex items-center justify-center font-medium cursor-pointer`,
                statusBtn: (active, colorClass) => `
                    h-8 px-3 text-xs rounded-lg cursor-pointer transition-all duration-200 flex items-center justify-center
                    ${active 
                        ? 'font-bold text-white ' + colorClass + ' shadow-[inset_3px_3px_6px_rgba(0,0,0,0.2),inset_-2px_-2px_5px_rgba(255,255,255,0.3)]' 
                        : 'text-gray-500 bg-[#E0E5EC] shadow-[5px_5px_10px_rgb(163,177,198,0.5),-5px_-5px_10px_rgba(255,255,255,0.6)] hover:translate-y-[-1px]'}
                `,
            };

            const handleStatusChange = (id, newStatus) => {
                setChecklist((prev) => prev.map((item) => item.id === id ? { ...item, status: newStatus } : item));
            };

            const handleNoteChange = (id, newNote) => {
                setChecklist((prev) => prev.map((item) => (item.id === id ? { ...item, note: newNote } : item)));
            };

            // Generate Text
            useEffect(() => {
                const getStatusText = (status) => {
                    switch (status) {
                        case 'passed': return '‚úÖ‡∏ú‡πà‡∏≤‡∏ô';
                        case 'pending': return '‚≠ï‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£';
                        case 'edit': return 'üí¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                        default: return '';
                    }
                };

                let text = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£\n`;
                if (storeName) text += `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ : ${storeName}\n`;
                text += `INV : ${invNumber}\n`;
                text += `‡∏ä‡∏∑‡πà‡∏≠ : ${customerName}\n\n`;

                checklist.forEach((item) => {
                    const statusText = getStatusText(item.status);
                    const labelForText = item.label.replace(/\n/g, ' ');
                    let line = `${item.id} ${labelForText} ${statusText}`;
                    if (item.status === 'edit' && item.note) {
                        line += ` -> ${item.note}`;
                    }
                    text += `${line}\n`;
                });

                setGeneratedText(text);
            }, [storeName, invNumber, customerName, checklist]);

            const copyToClipboard = () => {
                const textArea = document.createElement("textarea");
                textArea.value = generatedText;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        setIsCopied(true);
                        setTimeout(() => setIsCopied(false), 2000);
                    }
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            };

            // --- Logic for Features with Firestore ---

            const resetForm = () => {
                setStoreName('');
                setInvNumber('');
                setCustomerName('');
                setChecklist(initialItems.map((item) => ({ ...item, status: 'pending', note: '' })));
                setCurrentId(null);
            };

            const handleSaveDraft = async () => {
                if (!user) return;
                
                const newItem = {
                    timestamp: getCurrentDateTime(),
                    timestamp_raw: firebase.firestore.FieldValue.serverTimestamp(), // for sorting
                    storeName,
                    invNumber,
                    customerName,
                    checklist: checklist
                };

                try {
                    await db.collection('users').doc(user.uid).collection('history').add(newItem);
                    resetForm();
                } catch (error) {
                    console.error("Error saving document: ", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                }
            };

            const handleResetOrDelete = async () => {
                if (currentId && user) {
                    try {
                        await db.collection('users').doc(user.uid).collection('history').doc(currentId).delete();
                        resetForm();
                    } catch (error) {
                        console.error("Error removing document: ", error);
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                    }
                } else {
                    resetForm();
                }
            };

            const handleRestore = (item) => {
                setStoreName(item.storeName || '');
                setInvNumber(item.invNumber || '');
                setCustomerName(item.customerName || '');
                if (item.checklist) setChecklist(item.checklist);
                setCurrentId(item.id);
                setCurrentView('form');
            };

            const handleClearHistory = async () => {
                if (!user) return;
                setIsClearingHistory(false); // Close modal first
                
                // Firestore doesn't support deleting collection, so we delete docs in batch
                try {
                    const snapshot = await db.collection('users').doc(user.uid).collection('history').get();
                    const batch = db.batch();
                    snapshot.docs.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                } catch (error) {
                    console.error("Error clearing history: ", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥");
                }
            };

            // --- EXPORT / IMPORT LOGIC ---
            const handleExportCSV = () => {
                if (history.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export");

                const headers = ["Date", "StoreName", "INV", "Customer", "ChecklistData"];
                
                const rows = history.map(item => {
                    const safe = (str) => `"${(str || '').replace(/"/g, '""')}"`;
                    return [
                        safe(item.timestamp),
                        safe(item.storeName),
                        safe(item.invNumber),
                        safe(item.customerName),
                        safe(JSON.stringify(item.checklist))
                    ].join(",");
                });

                const csvContent = "\uFEFF" + [headers.join(","), ...rows].join("\n");
                const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", `history_export_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleImportCSV = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const text = e.target.result;
                    const lines = text.split("\n");
                    const dataRows = lines.slice(1); // Skip header

                    let successCount = 0;
                    const collectionRef = db.collection('users').doc(user.uid).collection('history');

                    for (let line of dataRows) {
                        if (!line.trim()) continue;
                        
                        // Simple CSV parser logic for quoted strings
                        const row = [];
                        let inQuote = false;
                        let currentVal = '';
                        for(let i=0; i<line.length; i++){
                            const char = line[i];
                            if(char === '"'){
                                if(inQuote && line[i+1] === '"'){
                                    currentVal += '"';
                                    i++;
                                } else {
                                    inQuote = !inQuote;
                                }
                            } else if(char === ',' && !inQuote){
                                row.push(currentVal);
                                currentVal = '';
                            } else {
                                currentVal += char;
                            }
                        }
                        row.push(currentVal);
                        
                        // Expected indices: 0:Date, 1:Store, 2:INV, 3:Customer, 4:ChecklistJSON
                        if (row.length >= 5) {
                            try {
                                const checklist = JSON.parse(row[4]);
                                const newItem = {
                                    timestamp: row[0] || getCurrentDateTime(),
                                    timestamp_raw: firebase.firestore.FieldValue.serverTimestamp(),
                                    storeName: row[1],
                                    invNumber: row[2],
                                    customerName: row[3],
                                    checklist: checklist
                                };
                                await collectionRef.add(newItem);
                                successCount++;
                            } catch (err) {
                                console.error("Skipping row", err);
                            }
                        }
                    }
                    
                    if (successCount > 0) alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                };
                reader.readAsText(file);
                event.target.value = ''; 
            };

            const triggerImport = () => {
                if (fileInputRef.current) fileInputRef.current.click();
            };

            const handleLogout = () => {
                auth.signOut();
            };

            const filteredHistory = history.filter(item => {
                const query = searchQuery.toLowerCase();
                return (
                    (item.storeName || '').toLowerCase().includes(query) ||
                    (item.invNumber || '').toLowerCase().includes(query) ||
                    (item.customerName || '').toLowerCase().includes(query)
                );
            });

            // --- LOADING STATE ---
            if (authLoading) {
                return (
                    <div className={`min-h-screen ${styles.bg} flex items-center justify-center`}>
                        <div className="animate-pulse text-blue-900 font-bold text-xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                    </div>
                );
            }

            // --- AUTH PAGE ---
            if (!user) {
                return <AuthPage />;
            }

            // --- MAIN APP ---
            return (
                <div className={`min-h-screen ${styles.bg} ${styles.text} p-4 md:p-8 flex justify-center items-start`}>
                    <div className={`w-full max-w-3xl ${styles.neuFlat} p-6 md:p-8 space-y-6 relative overflow-hidden transition-all duration-300`}>
                        
                        {/* Header & Navigation */}
                        <div className="flex items-center justify-between mb-2">
                             <div className="flex items-center gap-3">
                                <div className={`p-3 rounded-full ${styles.neuFlat} text-blue-900`}>
                                    <ClipboardListIcon size={28} />
                                </div>
                                <div>
                                    <h1 className="text-xl md:text-2xl font-bold text-blue-900 tracking-wide hidden sm:block">
                                        ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                                    </h1>
                                    <div className="text-xs text-gray-500 font-medium sm:hidden block">
                                        ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, {user.displayName || user.email}
                                    </div>
                                </div>
                             </div>
                             
                             {/* User Profile & View Toggle */}
                             <div className="flex items-center gap-4">
                                <div className="hidden sm:flex flex-col items-end mr-2">
                                    <span className="text-sm font-bold text-blue-900">{user.displayName || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}</span>
                                    <span className="text-xs text-gray-500">{user.email}</span>
                                </div>

                                <button 
                                    onClick={() => { setCurrentView('form'); setIsClearingHistory(false); }}
                                    className={`${styles.btn} p-3 rounded-full ${currentView === 'form' ? 'text-blue-600 ' + styles.neuPressed : 'text-gray-500 ' + styles.neuFlat}`}
                                    title="‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
                                >
                                    <Edit3Icon size={20} />
                                </button>
                                <button 
                                    onClick={() => setCurrentView('history')}
                                    className={`${styles.btn} p-3 rounded-full relative ${currentView === 'history' ? 'text-blue-600 ' + styles.neuPressed : 'text-gray-500 ' + styles.neuFlat}`}
                                    title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"
                                >
                                    <HistoryIcon size={20} />
                                    {history.length > 0 && (
                                        <span className="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-[#E0E5EC]"></span>
                                    )}
                                </button>
                                <button 
                                    onClick={handleLogout}
                                    className={`${styles.btn} p-3 rounded-full text-red-500 hover:text-red-700 ${styles.neuFlat}`}
                                    title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö"
                                >
                                    <LogoutIcon size={20} />
                                </button>
                             </div>
                        </div>

                        {/* VIEW: FORM */}
                        {currentView === 'form' && (
                            <div className="animate-fadeIn space-y-8">
                                {/* Section 1: User Info Inputs */}
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-lg font-semibold text-blue-900 ml-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h2>
                                        {currentId && (
                                            <span className="text-xs font-bold text-orange-600 bg-orange-100 px-2 py-1 rounded-lg border border-orange-200">
                                                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
                                            </span>
                                        )}
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="relative">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                                <StoreIcon size={18} />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤"
                                                value={storeName}
                                                onChange={(e) => setStoreName(e.target.value)}
                                                className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                            />
                                        </div>
                                        <div className="relative">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                                <FileTextIcon size={18} />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="‡πÄ‡∏•‡∏Ç INV"
                                                value={invNumber}
                                                onChange={(e) => setInvNumber(e.target.value)}
                                                className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                            />
                                        </div>
                                        <div className="relative md:col-span-2">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                                <UserIcon size={18} />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤"
                                                value={customerName}
                                                onChange={(e) => setCustomerName(e.target.value)}
                                                className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* ACTION BUTTONS */}
                                <div className="grid grid-cols-2 gap-4 py-2">
                                    <button
                                        onClick={handleSaveDraft}
                                        className={`${styles.btn} ${styles.neuFlat} py-3 text-emerald-700 hover:text-emerald-900 active:text-emerald-800 gap-2`}
                                    >
                                        <SaveIcon size={20} />
                                        <span>‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</span>
                                    </button>

                                    <button
                                        onClick={handleResetOrDelete}
                                        className={`${styles.btn} ${styles.neuFlat} py-3 text-red-600 hover:text-red-800 active:text-red-700 gap-2`}
                                    >
                                        {currentId ? (
                                            <>
                                                <TrashIcon size={20} />
                                                <span>‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</span>
                                            </>
                                        ) : (
                                            <>
                                                <XIcon size={20} />
                                                <span>‡∏ú‡πà‡∏≤‡∏ô/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                                            </>
                                        )}
                                    </button>
                                </div>

                                <hr className="border-gray-300/50" />

                                {/* Section 2: Checklist */}
                                <div className="space-y-6">
                                    <h2 className="text-lg font-semibold text-blue-900 ml-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h2>
                                    
                                    <div className="space-y-4">
                                        {checklist.map((item) => (
                                            <div key={item.id} className={`p-4 rounded-2xl bg-[#E0E5EC] shadow-[6px_6px_12px_rgb(163,177,198,0.5),-6px_-6px_12px_rgba(255,255,255,0.8)] transition-all`}>
                                                <div className="flex flex-col md:flex-row md:items-center justify-between gap-3">
                                                    <div className="flex-1 flex items-start">
                                                        <span className="font-medium text-gray-700 text-sm md:text-base mr-2 min-w-[20px]">
                                                            {item.id}.
                                                        </span>
                                                        <span className="font-medium text-gray-700 text-sm md:text-base whitespace-pre-line">
                                                            {item.label}
                                                        </span>
                                                    </div>

                                                    <div className="flex flex-wrap gap-2 shrink-0">
                                                        <div onClick={() => handleStatusChange(item.id, 'passed')} className={styles.statusBtn(item.status === 'passed', 'bg-blue-900')}>
                                                            <span className="flex items-center gap-1"><CheckIcon size={14}/> ‡∏ú‡πà‡∏≤‡∏ô</span>
                                                        </div>
                                                        <div onClick={() => handleStatusChange(item.id, 'pending')} className={styles.statusBtn(item.status === 'pending', 'bg-gray-500')}>
                                                            <span className="flex items-center gap-1"><ClockIcon size={14}/> ‡∏£‡∏≠</span>
                                                        </div>
                                                        <div onClick={() => handleStatusChange(item.id, 'edit')} className={styles.statusBtn(item.status === 'edit', 'bg-orange-500')}>
                                                            <span className="flex items-center gap-1"><Edit3Icon size={14}/> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {item.status === 'edit' && (
                                                    <div className="mt-3 animate-fadeIn">
                                                        <input
                                                            type="text"
                                                            placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç..."
                                                            value={item.note}
                                                            onChange={(e) => handleNoteChange(item.id, e.target.value)}
                                                            className={`w-full px-4 py-2 text-sm ${styles.neuPressed} text-red-600 placeholder-red-300 outline-none bg-transparent`}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Section 3: Output */}
                                <div className="pt-4 pb-8">
                                    <h2 className="text-lg font-semibold text-blue-900 ml-1 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
                                    <div className={`w-full p-4 min-h-[200px] text-sm md:text-base font-mono bg-gray-100/50 ${styles.neuPressed} text-gray-700 whitespace-pre-line leading-relaxed`}>
                                        {generatedText}
                                    </div>
                                    
                                    <button
                                        onClick={copyToClipboard}
                                        className={`mt-6 w-full py-4 text-blue-900 font-bold text-lg rounded-xl flex items-center justify-center gap-2 ${
                                            isCopied 
                                                ? 'shadow-[inset_4px_4px_8px_rgb(163,177,198,0.6),inset_-4px_-4px_8px_rgba(255,255,255,0.8)] bg-blue-50' 
                                                : 'shadow-[6px_6px_12px_rgb(163,177,198,0.6),-6px_-6px_12px_rgba(255,255,255,0.8)] hover:shadow-[8px_8px_16px_rgb(163,177,198,0.7),-8px_-8px_16px_rgba(255,255,255,0.9)] active:shadow-[inset_4px_4px_8px_rgb(163,177,198,0.6),inset_-4px_-4px_8px_rgba(255,255,255,0.8)]'
                                        } transition-all duration-300 cursor-pointer`}
                                    >
                                        {isCopied ? (
                                            <span className="flex items-center gap-2"><CheckIcon size={24} /> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span>
                                        ) : (
                                            <span className="flex items-center gap-2"><CopyIcon size={24} /> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                                        )}
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* VIEW: HISTORY */}
                        {currentView === 'history' && (
                            <div className="animate-fadeIn h-full flex flex-col">
                                <div className="flex items-center justify-between mb-6">
                                    <div className="flex items-center gap-2">
                                        <button onClick={() => { setCurrentView('form'); setIsClearingHistory(false); }} className="p-2 -ml-2 text-gray-500 hover:text-blue-900 transition-colors">
                                            <ArrowLeftIcon size={24} />
                                        </button>
                                        <h2 className="text-lg font-semibold text-blue-900">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h2>
                                    </div>
                                    
                                    <div className="flex items-center gap-2">
                                        {/* Import / Export Buttons */}
                                        <input 
                                            type="file" 
                                            accept=".csv"
                                            ref={fileInputRef}
                                            onChange={handleImportCSV}
                                            className="hidden"
                                        />
                                        <button 
                                            onClick={triggerImport}
                                            className="text-blue-600 hover:text-blue-800 p-2 transition-colors bg-[#E0E5EC] shadow-[3px_3px_6px_rgb(163,177,198,0.5),-3px_-3px_6px_rgba(255,255,255,0.6)] rounded-lg active:shadow-[inset_2px_2px_4px_rgb(163,177,198,0.5),inset_-2px_-2px_4px_rgba(255,255,255,0.6)]"
                                            title="‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå CSV"
                                        >
                                            <UploadIcon size={20} />
                                        </button>
                                        <button 
                                            onClick={handleExportCSV}
                                            className="text-blue-600 hover:text-blue-800 p-2 transition-colors bg-[#E0E5EC] shadow-[3px_3px_6px_rgb(163,177,198,0.5),-3px_-3px_6px_rgba(255,255,255,0.6)] rounded-lg active:shadow-[inset_2px_2px_4px_rgb(163,177,198,0.5),inset_-2px_-2px_4px_rgba(255,255,255,0.6)]"
                                            title="‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô CSV"
                                        >
                                            <DownloadIcon size={20} />
                                        </button>

                                        {/* Clear History Button */}
                                        {history.length > 0 && (
                                            <button 
                                                onClick={() => setIsClearingHistory(true)}
                                                className="text-red-400 hover:text-red-600 p-2 transition-colors bg-[#E0E5EC] shadow-[3px_3px_6px_rgb(163,177,198,0.5),-3px_-3px_6px_rgba(255,255,255,0.6)] rounded-lg active:shadow-[inset_2px_2px_4px_rgb(163,177,198,0.5),inset_-2px_-2px_4px_rgba(255,255,255,0.6)]"
                                                title="‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                                            >
                                                <TrashIcon size={20} />
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Confirmation Box */}
                                {isClearingHistory && (
                                    <div className="mb-6 p-4 rounded-xl bg-red-50 border border-red-100 animate-popIn">
                                        <div className="flex items-start gap-3">
                                            <div className="text-red-500 mt-1"><AlertIcon size={24}/></div>
                                            <div className="flex-1">
                                                <h3 className="font-bold text-red-800 mb-1">‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÑ‡∏´‡∏°?</h3>
                                                <p className="text-sm text-red-600 mb-3">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
                                                <div className="flex gap-3">
                                                    <button 
                                                        onClick={handleClearHistory}
                                                        className="px-4 py-2 bg-red-500 text-white text-sm rounded-lg shadow-md hover:bg-red-600 transition-colors"
                                                    >
                                                        ‡πÉ‡∏ä‡πà ‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                                                    </button>
                                                    <button 
                                                        onClick={() => setIsClearingHistory(false)}
                                                        className="px-4 py-2 bg-white text-gray-600 text-sm rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors"
                                                    >
                                                        ‡∏Å‡∏î‡∏ú‡∏¥‡∏î ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Search Bar */}
                                <div className="relative mb-6">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                        <SearchIcon size={18} />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô, ‡πÄ‡∏•‡∏Ç INV, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className={`w-full pl-10 pr-4 py-3 ${styles.neuPressed} outline-none focus:ring-2 focus:ring-blue-200/50 transition-all bg-transparent`}
                                    />
                                </div>

                                {/* List - Adjusted spacing and rounded corners */}
                                <div className="flex-1 space-y-6 p-6 overflow-y-auto no-scrollbar">
                                    {filteredHistory.length === 0 ? (
                                        <div className="text-center py-10 text-gray-400">
                                            <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>
                                        </div>
                                    ) : (
                                        filteredHistory.map((item) => (
                                            <div 
                                                key={item.id} 
                                                onClick={() => handleRestore(item)}
                                                className={`p-5 rounded-2xl bg-[#E0E5EC] shadow-[5px_5px_10px_rgb(163,177,198,0.6),-5px_-5px_10px_rgba(255,255,255,0.8)] border border-[#E0E5EC] hover:translate-y-[-2px] transition-all cursor-pointer group`}
                                            >
                                                <div className="flex justify-between items-start mb-2">
                                                    {/* Edited Date Style */}
                                                    <span className="text-xs italic text-gray-500">
                                                        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î : {item.timestamp}
                                                    </span>
                                                    <span className="text-blue-400 group-hover:text-blue-600 transition-colors">
                                                        <Edit3Icon size={16} />
                                                    </span>
                                                </div>
                                                <div className="space-y-1">
                                                    <p className="text-sm text-gray-600"><span className="font-semibold text-blue-900">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ :</span> {item.storeName || '-'}</p>
                                                    <p className="text-sm text-gray-600"><span className="font-semibold text-blue-900">‡πÄ‡∏•‡∏Ç INV :</span> {item.invNumber || '-'}</p>
                                                    <p className="text-sm text-gray-600"><span className="font-semibold text-blue-900">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ :</span> {item.customerName || '-'}</p>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Developer Signature */}
                        <div className="pt-6 mt-4 border-t border-gray-300/30 text-center">
                            <p className="text-[10px] text-gray-400 font-light tracking-widest uppercase opacity-70 hover:opacity-100 transition-opacity select-none">
                                vibe code by a.pete from zenity-x
                            </p>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NeumorphismApp />);
    </script>
</body>
</html>
